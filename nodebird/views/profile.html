{% extends 'layout.html' %}

<!-- ì‚¬ìš©ìì˜ íŒ”ë¡œì›Œì™€ ì‚¬ìš©ìê°€ íŒ”ë¡œì‰ ì¤‘ì¸ ëª©ë¡ì„ ë³´ì—¬ì¤Œ -->

{% block content %}
  <div class="timeline">
    <h1>My Profile<button class="profile-update">í”„ë¡œí•„ ìˆ˜ì •</button></h1>
    <!-- form íƒœê·¸ëŠ”  GET, POST ë°©ì‹ë§Œ ê°€ëŠ¥ -->
    <form id="profile-update-form" action="/auth/update" method="post">
      <div class="input-group">
        <label for="update-email">ì´ë©”ì¼</label>
        <input id="update-email" type="email" name="email" value={{user.email}}></div>
      <div class="input-group">
        <label for="update-nick">ë‹‰ë„¤ì„</label>
        <input id="update-nick" type="text" name="nick" value={{user.nick}}></div>
      <div class="input-group">
        <label for="update-password">ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸</label>
        <input id="update-password" type="password" name="password">
      </div>
      <button id="profile-update-btn" type="submit" class="btn">ë³€ê²½</button>
    </form>
    <div class="followings half">
      <h2>ğŸ¤íŒ”ë¡œì‰ ëª©ë¡</h2>
      {% if user.Followings %}
        {% for following in user.Followings %}
          <div>{{following.nick}}</div>
        {% endfor %}
      {% endif %}
    </div>
    <div class="followers half">
      <h2>ğŸ¤íŒ”ë¡œì›Œ ëª©ë¡</h2>
      {% if user.Followers %}
        {% for follower in user.Followers %}
          <div>{{follower.nick}}</div>
        {% endfor %}
      {% endif %}
    </div>
  </div>

  <script>
    // í”„ë¡œí•„ ìˆ˜ì • í¼ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
    document.querySelector('.profile-update').addEventListener('click', function() {
      
      const form = document.querySelector('#profile-update-form');

      if (form.style.display !== 'none') {
        form.style.display = 'none';
      } else {
        const pwd = prompt('í”„ë¡œí•„ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ? \në¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        if (pwd == "" || pwd == null) {
          return pop();
        } else {
          axios.post(`/auth/checkPwd`, { password: pwd })
              .then(function (res) {
                console.log(res.data.isCorrected);
                if (res.data.isCorrected) {
                  form.style.display = 'block';
                } else {
                  alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                }
              })
              .catch((err) => {
                console.error(err);
              });
        }
      }
    });

  </script>
{% endblock %}